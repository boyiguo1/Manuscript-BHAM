\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={Supporting Infromation},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{Supporting Infromation}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

\newcommand{\tp}{*}
\newcommand{\pr}{\text{Pr}}
\newcommand{\bs}[1]{\boldsymbol{#1}}

\subsection{Supplementary Information 1: Marginal Distribution of $\gamma_j^\tp$}

Given that
\(\gamma_{j}^\tp | \gamma_{j}, \theta_j \sim Bin(1, \gamma_{j}\theta_j)\)
where \(\gamma_{j} | \theta_j \sim Bin(1, \theta_j)\), we can derive the
the marginal distribution of \(\gamma_{j}^\tp\) with the following
manipulation.

\begin{align*}
& \pr(\gamma_j^\tp = 1 | \theta_j)  = \pr(\gamma_j^\tp = 1, \gamma_j = 1 | \theta_j) + \pr(\gamma_j^\tp = 1 , \gamma_j = 0| \theta_j)\\
= & \pr(\gamma_j^\tp = 1, \gamma_j = 1 | \theta_j) + 0 \qquad \text{[hierarchical structure between }\gamma^\tp \text{ and }\gamma \text{.]}\\
= & \pr(\gamma_j^\tp = 1| \gamma_j = 1,  \theta_j)\pr(\gamma_j = 1| \theta_j)\\
= & \theta_j^2\\
& \pr(\gamma_j^\tp = 0 | \theta_j)  = \pr(\gamma_j^\tp = 0, \gamma_j = 1 | \theta_j) + \pr(\gamma_j^\tp = 0 , \gamma_j = 0| \theta_j)\\
= & \pr(\gamma_j^\tp = 0, \gamma_j = 1 | \theta_j) + \pr(\gamma_j^\tp = 0, \gamma_j = 0 | \theta_j)\\
= & \pr(\gamma_j^\tp = 0| \gamma_j = 1,  \theta_j)\pr(\gamma_j = 1| \theta_j) + \pr(\gamma_j^\tp = 0| \gamma_j = 0,  \theta_j)\pr(\gamma_j = 0| \theta_j)\\
= & (1-\theta_j)\theta_j + 1(1-\theta_j) = 1-\theta_j^2
\end{align*}

\clearpage

\subsection{Supplementary Information 2: EM-IWLS Algorithm for Fitting Bayesian Hierarchical Additive Models}

Similar to the EM-CD algorithm, the EM-IWLS algorithm is an iterative
EM-based algorithm where the iterative weighted least squares algorithm
is used to find the estimate of \(\bs \beta, \phi\) that maximizes
\(E(Q_1)\). The iterative weighted least squares algorithm was
originally proposed to fit the classical generalized linear models, and
generalized to fit some Bayesian hierarchical models.{[}@Gelman2013{]}
Yi and Ma {[}@Yi2012{]} formulated Student's t-distribution and double
exponential distribution as hierarchical normal distributions such that
generalized linear models with shrinkage priors can be easily fitted
using IWLS in combination with EM algorithm. In this work, we adapt the
EM-IWLS paradigm to fit BHAM with spike-and-slab spline prior .

A double exponential prior, \(\beta|S \sim DE(0, S)\) can be formulated
as a hierarchical normal prior with unknown variance \(\tau^2\)
integrated out:

\begin{align*}
  \beta|\tau^2 &\sim N(0, \tau^2)\\
  \tau^2|S & \sim Gamma(1, 1/(2S^2)), 
\end{align*}

For the mixture double exponential priors, we can define the scale
parameter \(S = (1-\gamma)s_0 + \gamma s_1\) following Equation
(\ref{eq:ssl}). The change in the prior formulation in turn leads to the
change in the log posterior density function, as \(Q_1\) needs to
account for the hyperprior of \(\tau^2\):

\begin{equation}\label{eq:Q1_IWLS}
Q_1(\bs \beta, \phi) = \log f(\textbf{y}|\bs \beta, \phi) + \sum\limits_{j=1}^p\left[\log f(\beta_j|{\tau}^2_j) + \log f({\tau}^2_j| S_j)+\sum\limits_{k=1}^{K_j} \{\log f(\beta^{\tp}_{jk}|{\tau^{\tp}}^2_{jk})+\log f({\tau^\tp}^2_{jk}| S^\tp_j)\}\right].
\end{equation}

Since \(\bs \tau^2\) are not of our primary interest, we treat them as
the ``missing'' data in addition to the latent indicators
\(\bs \gamma\), and hence construct the expectation
\(E_{\bs \gamma, \bs \tau^2|\Theta^{(t-1)}}(Q_1)\) in the E-step. To
note, unlike the same latent indicator \(\gamma^\tp_j\) which is shared
by the coefficients of the non-linear terms \(\beta^\tp_{jk}\) for
\(k = 1, \dots, K_j\) , \(\tau^2_{jk}\) is coefficient specific for
\(\beta^\tp_{jk}\).
\(E({S_j}^{-1}|\beta_j, s_0, s_1), E({S^\tp}^{-1}_j|\bs \beta_j^\tp, s_0, s_1), E({\tau}^2_{j}|S_j, \beta_j) \text{ and } E({\tau^\tp}^2_{jk}|S_j^\tp, \beta^\tp_{jk})\)
needs to be calculated to formulate \(E(Q_1)\). As neither
\(E({S_j}^{-1}|\beta_j, s_0, s_1)\) nor
\(E({S^\tp}^{-1}_j|\bs \beta_j^\tp, s_0, s_1)\) depends on \(\tau^2\)s,
they can be derived using Equation (\ref{eq:exp_scale}). On the other
hand, \(\tau^{2}\), following gamma distributions, is a conjugate prior
for the normal variance, and the conditional posterior density of
\(\tau^{-2}\) is an inverse Gaussian distribution.
\(E({\tau}^{-2}_{j})\) and \(E({\tau^\tp}^{-2}_{jk})\) are calculated
using the closed form equation

\begin{align*}
 E({\tau}^{-2}_{j}|S_j, \beta_j) ={S_j}^{-1}/|\beta_j| \qquad E({\tau^\tp}^{-2}_{jk}|S_j^\tp, \beta^\tp_{jk})={S_j^\tp}^{-1}/|\beta^\tp_{jk}|,
\end{align*}

where \(S_j\) and \(S_j^\tp\) are replaced by the expectation and
\(\beta\)s are replaced with \(\beta^{(t-1)}\). With simplification (up
to constant additive terms), we have

\begin{equation}\label{eq:EQ1_IWLS}
E(Q_1) = \log f(\textbf{y}|\bs \beta, \phi) - \sum\limits_{j=1}^p\left[ {2E({\tau_j}^{-2})}{\beta_j}^2 +\sum\limits_{k=1}^{K_j} {2E({\tau_{jk}^\tp}^{-2})}{\beta_{jk}^\tp}^2\right].
\end{equation}

\(2E({\tau}^{-2})\beta^2\) can be seen as the kernel of a normal density
with mean 0 and variance \(E(\tau^{2})\), and we can formulate the
coefficients \(\bs \beta\) as a multivariate normal distribution with
means \(\bs 0\) and variance covariance matrix \(\bs \Sigma_{\tau^2}\),
where \(\bs \Sigma_{\tau^2}\) is a diagonal matrix with \(E(\tau^2)\)s
on the diagonal, \[
\bs \beta \sim \text{MVN}(0, \bs \Sigma_{\tau^2}).
\]

Meanwhile, following the classical IWLS, we can approximate the
generalized model likelihood at each iteration with a weighted normal
likelihood: \[
f(\textbf{y}|\bs \beta, \phi) \approx \text{MVN}(\textbf{z}|\bs X \bs \beta, \phi\bs \Sigma )
\] where the `normal response' \(z_i\) and `weight' \(w_i\) are called
the pseudo-response and pseudo-weight respectively. The pseudo-response
and the pseudo-weight are calculated by \[
\begin{aligned}
z_i &= \hat\eta_i - \frac{L^{'}(y_i|\hat\eta_i)}{L^{''}(y_i|\hat\eta_i)}& w_i &= - L^{''}(y_i|\hat\eta_i),
\end{aligned}
\] where \(\hat\eta_i = (\bs X {\hat{\bs\beta}})_i\),
\(L^{'}(y_i|\hat\eta_i, \hat \phi)\) and
\(L^{''}(y_i|\hat\eta_i, \hat \phi)\) are the first and second
derivative of the log density, \(\log f(\textbf{y}_i|\bs \beta, \phi)\)
with respect to \(\eta_i\).

With \(\bs z\sim \text{MVN}(\bs X \bs \beta, \phi \bs \Sigma)\) and
\(\bs \beta \sim \text{MVN}(0, \phi \bs \Sigma_{\tau^2})\), we can
augment the two multivariate normal distributions and update the
estimates for \(\bs \beta\) and \(\phi\) via least squares in each
iteration of the EM algorithm. We create the augmented response,
augmented data, and augmented variance-covariance matrix following

\begin{align*}
& \bs z_* = \begin{bmatrix} \bs z\\ \bs 0\end{bmatrix} &&
  \bs X_* = \begin{bmatrix} \bs X \\ \bs I \end{bmatrix} &&
  \bs \Sigma_* = \begin{bmatrix} \bs \Sigma & \bs 0  \\ \bs 0 & \bs \Sigma_{\tau^2}/\phi \end{bmatrix}, &
\end{align*}

such that \[
\bs z_* \sim \text{MVN}(\bs X_* \bs \beta , \phi \Sigma_*).
\] Using the least squares estimators to update \(\bs\beta\) and
\(\phi\), we have

\begin{align*}
& \bs \beta^{(t)} = (\bs X_*^T \bs \Sigma^{-1} \bs X_*)^{-1}\bs X_*^T \bs \Sigma^{-1} \bs z_* && \phi^{(t)} = \frac{1}{n}(\bs z_*-X_*\bs \beta^{(t)})^T\bs \Sigma^{-1}(\bs z_*-X_*\bs \beta^{(t)}).&
\end{align*}

To note, the variance-covariance matrix of the coefficient estimates
variance-covariance matrix can be derived in the EM-IWLS algorithm and
in turn can be used for statistical inferences, \[
  \text{Var}(\bs\beta^{(t)}) = (\bs X_*^T\bs \Sigma^{-1} \bs X_*)^{-1}\phi^{(t)}.
\]

Totally, the proposed EM-IWLS algorithm is summarized as follows:

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  Choose a starting value \(\bs \beta^{(0)}\) and \(\bs \theta^{(0)}\)
  for \(\bs \beta\) and \(\bs \theta\). For example, we can initialize
  \(\bs \beta^{(0)} = \bs 0\) and \(\bs \theta^{(0)} = \bs 0.5\)
\item
  Iterate over the E-step and M-step until convergence

  E-step: calculate \(E(\gamma_{j})\), \(E(\gamma^\tp_{j})\) and
  \(E(\tau^{-2}_{j})\), \(E({\tau^\tp}^{-2}_{jk})\) with the estimates
  \(\Theta^{(t-1)}\) from the previous iteration

  M-step:

  \begin{enumerate}
  \def\labelenumii{\alph{enumii})}
  \tightlist
  \item
    Based on the current value of \(\beta\), calculate the pseudo-data
    \(z_i^{(t)}\) and the pseudo-weights \(w_i^{(t)}\)
  \item
    Update \(\bs \beta^{(t)}\) by runing the augmented weighted least
    squared
  \item
    If \(\phi\) is present, update \(\phi\)
  \end{enumerate}
\end{enumerate}

Similar to EM-CD, we assess convergence by the criterion,
\(|d^{(t)}-d^{(t-1)}|/(0.1+|d^{(t)}|)<\epsilon\), where \(\epsilon\) is
a small value (say \(10^{-5}\)).

\subsection{Supplementary Information 3: Predictive Performance of Linear Simulations}

\input{Manuscript/Tabs/sim_lnr_gaus_tab.tex} \clearpage
\input{Manuscript/Tabs/sim_lnr_binom_tab.tex}

\end{document}
